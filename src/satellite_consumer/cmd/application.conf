consumer {
    command = "consume"
    satellite = "rss"
    satellite = ${?SATCONS_SATELLITE}
    # The resolution in meters to process.
    resolution_meters = 3000
    resolution_meters = ${?SATCONS_RESOLUTION}
    start_timestamp = "2025-08-25T00:00:00Z"
    start_timestamp = ${?SATCONS_START_TIMESTAMP}
    end_timestamp = "2025-08-25T00:15:00Z"
    end_timestamp = ${?SATCONS_END_TIMESTAMP}
    # Parent folder to store downloaded and processed data in.
    # Can be either a local path or an S3 path (s3://bucket-name/prefix)
    # Ignored if SATCONS_RAW_PATH and SATCONS_ZARR_PATH are defined.
    workdir = "."
    workdir = ${?SATCONS_WORKDIR}
    # The name of the region to crop to. An empty string means no cropping.
    crop_region = ""
    crop_region = ${?SATCONS_CROP_REGION}
    raw_path = ${consumer.workdir}/raw
    raw_path = ${?SATCONS_RAW_PATH}
    keep_raw = true
    keep_raw = ${?SATCONS_KEEP_RAW}
    zarr_path = ${consumer.workdir}/data/${consumer.satellite}.zarr
    zarr_path = ${?SATCONS_ZARR_PATH}
    use_icechunk = false
    use_icechunk = ${?SATCONS_ICECHUNK}
    loglevel = "INFO"
    loglevel = ${?LOGLEVEL}
    # Number of images to prefetch for writing
    buffer_size = 3
    buffer_size=${?SATCONS_BUFFER_SIZE}
    # Size of worker pool
    max_workers = 3
    max_workers=${?SATCONS_MAX_WORKERS}
    # Whether worker pool is "processes" or "threads"
    executor = "threads"
    executor=${?SATCONS_EXECUTOR}
    # Number of images to accumulate before writing each block
    accum_writes = 1
    accum_writes=${?SATCONS_ACCUM_WRITES}
}

satellites {
    rss {
        region="europe"
        cadence_mins=5
        product_id="EO:EUM:DAT:MSG:MSG15-RSS"
        sensor="seviri"
        description="""
Rectified (level 1.5) Meteosat SEVIRI Rapid Scan image data for Europe. 
The image region is the top 1/3 of the earth's disk,
covering a latitude range from approximately 15 degrees to 70 degrees.
The data is transmitted as High Rate transmissions in 12 spectral channels
(11 low and one high resolution). 
See https://user.eumetsat.int/catalogue/EO:EUM:DAT:MSG:MSG15-RSS"""
        file_filter_regex="\S+\.nat$"
        encoding {
            _ARRAY_DIMENSIONS=["time", "y_geostationary", "x_geostationary", "channel"]
			      # Data variables
	          data { dtype="<f2", fill_value=nan, chunks=[1, 348, 464, -1], shards=[1, 1392, 3712, -1], compressors=yes }
        	  instrument { dtype=<U26, chunks=[10000] }
        	  satellite_actual_longitude { dtype=float64, chunks=[10000] }
        	  satellite_actual_latitude { dtype=float64, chunks=[10000] }
        	  satellite_actual_altitude { dtype=float64, chunks=[10000] }
        	  cal_offset { dtype=float64, chunks=[10000] }
        	  cal_slope  { dtype=float64, chunks=[10000] }
        	  projection_longitude { dtype=float64, chunks=[10000] }
        	  projection_latitude { dtype=float64, chunks=[10000] }
        	  # Coordinates
        	  channel { dtype=str }
        	  time { dtype=int, units="nanoseconds since 1970-01-01", calendar="proleptic_gregorian", chunks=[10000] }
        }
    }
    iodc {
        region="india"
        cadence_mins=15
        product_id="EO:EUM:DAT:MSG:HRSEVIRI-IODC"
        sensor="seviri"
        description="""
Rectified (level 1.5) Meteosat SEVIRI image data for the Indian Ocean. 
The data is transmitted as High Rate transmissions in 12 spectral channels
(11 low and one high resolution). 
See https://user.eumetsat.int/catalogue/EO:EUM:DAT:MSG:HRSEVIRI-IODC"""
        file_filter_regex="\S+\.nat$"
        encoding {
            _ARRAY_DIMENSIONS=["time", "y_geostationary", "x_geostationary", "channel"]
			      # Data variables
	          data { dtype="<f2", fill_value=nan, chunks=[1, 464, 464, -1], shards=[1, 3712, 3712, -1], compressors=yes }
        	  instrument { dtype=<U26, chunks=[10000] }
        	  satellite_actual_longitude { dtype=float64, chunks=[10000] }
        	  satellite_actual_latitude { dtype=float64, chunks=[10000] }
        	  satellite_actual_altitude { dtype=float64, chunks=[10000] }
        	  cal_offset { dtype=float64, chunks=[10000] }
        	  cal_slope  { dtype=float64, chunks=[10000] }
        	  projection_longitude { dtype=float64, chunks=[10000] }
        	  projection_latitude { dtype=float64, chunks=[10000] }
        	  # Coordinates
        	  channel { dtype=str }
        	  time { dtype=int, units="nanoseconds since 1970-01-01", calendar="proleptic_gregorian", chunks=[10000] }
        }
    }
    odegree {
        region="europe, africa"
        cadence_mins=15
        product_id="EO:EUM:DAT:MSG:HRSEVIRI"
        sensor="seviri"
        description="""
Rectified (level 1.5) Meteosat SEVIRI image data for Europe and Africa. 
The data is transmitted as High Rate transmissions in 12 spectral channels
(11 low and one high resolution). 
See https://user.eumetsat.int/catalogue/EO:EUM:DAT:MSG:HRSEVIRI"""
        file_filter_regex="\S+\.nat$"
		    encoding {
            _ARRAY_DIMENSIONS=["time", "y_geostationary", "x_geostationary", "channel"]
            # Data variables
            data { dtype="<f2", fill_value=nan, chunks=[1, 464, 464, -1], shards=[1, 3712, 3712, -1], compressors=yes }
            instrument { dtype=<U26, chunks=[10000] }
            satellite_actual_longitude { dtype=float64, chunks=[10000] }
            satellite_actual_latitude { dtype=float64, chunks=[10000] }
            satellite_actual_altitude { dtype=float64, chunks=[10000] }
            cal_offset { dtype=float64, chunks=[10000] }
            cal_slope  { dtype=float64, chunks=[10000] }
            projection_longitude { dtype=float64, chunks=[10000] }
            projection_latitude { dtype=float64, chunks=[10000] }
            # Coordinates
            channel { dtype=str }
            time { dtype=int, units="nanoseconds since 1970-01-01", calendar="proleptic_gregorian", chunks=[10000] }
        }
    }
    odegree-12 {
        region="europe, africa"
        cadence_mins=10
        product_id="EO:EUM:DAT:0662"
        sensor="mtg"
        description="""
Rectified (level 1c) Meteosat-12 image data for Europe and Africa. 
The data is transmitted as High Rate transmissions in 16 spectral channels
(12 low and 4 high resolution). 
See https://user.eumetsat.int/catalogue/EO:EUM:DAT:0662"""
        # Return only files covering the top of the UK
        file_filter_regex="\S+BODY\S+00(?:[3][2-9]|40).nc$"
        encoding {
            _ARRAY_DIMENSIONS=["time", "y_geostationary", "x_geostationary", "channel"]
            # Data variables
            data { dtype="<f2", fill_value=nan, chunks=[1, 400, 400, -1], shards=[1, -1, -1, -1], compressors=yes }
            instrument { dtype=<U26, chunks=[10000] }
            satellite_actual_longitude { dtype=float64, chunks=[10000] }
            satellite_actual_latitude { dtype=float64, chunks=[10000] }
            satellite_actual_altitude { dtype=float64, chunks=[10000] }
            cal_offset { dtype=float64, chunks=[10000] }
            cal_slope  { dtype=float64, chunks=[10000] }
            projection_longitude { dtype=float64, chunks=[10000] }
            projection_latitude { dtype=float64, chunks=[10000] }
            # Coordinates
            channel { dtype=str }
            time { dtype=int, units="nanoseconds since 1970-01-01", calendar="proleptic_gregorian", chunks=[10000] }
        }
    }
}

sensors {
    seviri {
        # See https://user.eumetsat.int/s3/eup-strapi-media/pdf_ten_05105_msg_img_data_e7c8b315e6.pdf
        channels {
            VIS006 = {res=[3000], repr="reflectance", satpy_idx=0}
            VIS008 = {res=[3000], repr="reflectance", satpy_idx=1}
            IR_016 = {res=[3000], repr="reflectance", satpy_idx=2}
            IR_039 = {res=[3000], repr="brightness_temperature", satpy_idx=3}
            WV_062 = {res=[3000], repr="brightness_temperature", satpy_idx=4}
            WV_073 = {res=[3000], repr="brightness_temperature", satpy_idx=5}
            IR_087 = {res=[3000], repr="brightness_temperature", satpy_idx=6}
            IR_097 = {res=[3000], repr="brightness_temperature", satpy_idx=7}
            IR_108 = {res=[3000], repr="brightness_temperature", satpy_idx=8}
            IR_120 = {res=[3000], repr="brightness_temperature", satpy_idx=9}
            IR_134 = {res=[3000], repr="brightness_temperature", satpy_idx=10}
            HRV = {res=[1000], repr="reflectance", satpy_idx=11}
        }
    }
    mtg {
        # See https://user.eumetsat.int/resources/user-guides/mtg-fci-level-1c-data-guide
		# * NOTE: ir_38 and ir_105 also have 1000m resolution data, but Satpy errors when trying to read it.
		# * I need to investigate further to fix.
        channels {
            vis_04 = {res=[1000], repr="reflectance", satpy_idx=0}
            vis_05 = {res=[1000], repr="reflectance", satpy_idx=1}
            vis_06 = {res=[1000, 500], repr="reflectance", satpy_idx=2}
            vis_08 = {res=[1000], repr="reflectance", satpy_idx=3}
            vis_09 = {res=[1000], repr="reflectance", satpy_idx=4}
            nir_13 = {res=[1000], repr="reflectance", satpy_idx=5}
            nir_16 = {res=[1000], repr="reflectance", satpy_idx=6}
            nir_22 = {res=[1000, 500], repr="reflectance", satpy_idx=7}
            ir_38 = {res=[2000], repr="brightness_temperature", satpy_idx=8}
            wv_63 = {res=[2000], repr="brightness_temperature", satpy_idx=9}
            wv_73 = {res=[2000], repr="brightness_temperature", satpy_idx=10}
            ir_87 = {res=[2000], repr="brightness_temperature", satpy_idx=11}
            ir_97 = {res=[2000], repr="brightness_temperature", satpy_idx=12}
            ir_105 = {res=[2000], repr="brightness_temperature", satpy_idx=13}
            ir_123 = {res=[2000], repr="brightness_temperature", satpy_idx=14}
            ir_133 = {res=[2000], repr="brightness_temperature", satpy_idx=15}
        }
    }
}

regions {
    uk = {left = -17, bottom = 44, right = 11, top = 73}
    west-europe = {left = -17, bottom = 35, right = 26, top = 73}
    india = {left = 60, bottom = 6, right = 97, top = 37}
}

sentry {
    dsn = ""
    dsn = ${?SENTRY_DSN}
    environment = "local"
    environment = ${?SENTRY_ENVIRONMENT}
}

credentials {
    eumetsat {
	key = ${EUMETSAT_CONSUMER_KEY}
	secret = ${EUMETSAT_CONSUMER_SECRET}
    }
    aws {
        access_key_id = ${?AWS_ACCESS_KEY_ID}
	secret_access_key = ${?AWS_SECRET_ACCESS_KEY}
	region = "eu-west-1"
	region = ${?AWS_REGION}
	endpoint = ${?AWS_ENDPOINT}
    }
    gcp {
	application_credentials = ${?GOOGLE_APPLICATION_CREDENTIALS}
    }
}
